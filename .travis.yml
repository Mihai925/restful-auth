language: node_js
node_js:
  - "12"

jobs:
  include:
    - script: npm run test-integ-ddb

    - script: npm run test-integ-sqlite

    - services: mysql
      before_script: mysql -e 'CREATE DATABASE IF NOT EXISTS test;'
      script: npm run test-integ-mysql

    - services: postgresql
      before_script: psql -c 'create database test;' -U postgres
      script: npm run test-integ-psql

    - before_script:
      - sudo bash -c 'curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -'
      - sudo bash -c 'curl https://packages.microsoft.com/config/ubuntu/18.04/prod.list > /etc/apt/sources.list.d/mssql-release.list'
      - sudo apt-get update
      - sudo ACCEPT_EULA=Y apt-get install msodbcsql17
      script: npm run test-integ-mssql

    - addons:
        mariadb: '10.5'
      before_script:
       - sudo mysql -e 'CREATE DATABASE IF NOT EXISTS test;'
       - sudo mysql -e 'drop user if exists travis@localhost;'
       - sudo mysql -e 'create user travis@localhost;'
       - sudo mysql -e "GRANT ALL PRIVILEGES ON db.* TO 'travis'@'localhost'";
       - sudo mysql -e "GRANT ALL ON *.* to travis@localhost;";
      script: npm run test-integ-mariadb

after_success: npm run coverage